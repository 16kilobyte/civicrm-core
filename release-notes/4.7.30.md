# CiviCRM 4.7.30

Released February 7, 2018

- **[Synopsis](#synopsis)**
- **[Features](#features)**
- **[Bugs resolved](#bugs)**
- **[Miscellany](#misc)**
- **[Credits](#credits)**
- **[Feedback](#feedback)**

## <a name="synopsis"></a>Synopsis

| *Does this version...?*                                     |         |
|:----------------------------------------------------------- |:-------:|
| Fix security vulnerabilities?                               |         |
| Change the database schema?                                 |         |
| Alter the API?                                              |         |
| Require attention to configuration options?                 |         |
| Fix problems installing or upgrading to a previous version? |         |
| Introduce features?                                         |         |
| Fix bugs?                                                   |         |

## <a name="features"></a>Features

### Core CiviCRM

- **[CRM-21380](https://issues.civicrm.org/jira/browse/CRM-21380) Add setting to
  block  activity type from sending assignee notification
  ([11222](https://github.com/civicrm/civicrm-core/pull/11222))**

  Site administrators can now choose to suppress activity assignee notifications
  for certain activity types even while assignee notifications are enabled for
  other activity types.

- **[CRM-21584](https://issues.civicrm.org/jira/browse/CRM-21584) Add `CrmRegion`
  Tag to Contact Actions menu template
  ([11439](https://github.com/civicrm/civicrm-core/pull/11439))**

  The "Actions" menu item at the top of a contact record now is now specified as
  a region where extensions can easily insert markup.

- **[CRM-21575](https://issues.civicrm.org/jira/browse/CRM-21575) Websites of
  same type are over-written
  ([11428](https://github.com/civicrm/civicrm-core/pull/11428))**

  **FIXME** This may be modified because of a regression.

- **[CRM-13123](https://issues.civicrm.org/jira/browse/CRM-13123) Handle
  value-separated fields at the dao level
  ([11394](https://github.com/civicrm/civicrm-core/pull/11394))**

  There are various ways serialized data is stored as strings in the database,
  but handling of this was generally ad-hoc.  This change documents each field's
  serialization type (e.g. delimited values, PHP serialization, or JSON) and
  implements a common utility for serializing and unserializing values.

- **[CRM-21530](https://issues.civicrm.org/jira/browse/CRM-21530) Call post hook
  after activity is filed on case
  ([11385](https://github.com/civicrm/civicrm-core/pull/11385))**

  `hook_civicrm_post` is now invoked for a `CaseActivity` entity when an
  activity is filed to a case.  This allows extension developers to have certain
  actions be triggered by the event.

- **[CRM-21499](https://issues.civicrm.org/jira/browse/CRM-21499) Add filter to
  manage tags page ([11368](https://github.com/civicrm/civicrm-core/pull/11368)
  and [11352](https://github.com/civicrm/civicrm-core/pull/11352))**

  An administrator may now filter the list of tags by partial name on the Manage
  Tags page.

- **[CRM-21443](https://issues.civicrm.org/jira/browse/CRM-21443) Add support
  for auto-complete fields in the batch update forms
  ([11290](https://github.com/civicrm/civicrm-core/pull/11290))**

  Previously, the batch update form would exclude autocomplete-select custom
  fields.  This adds support for them.

- **[CRM-21286](https://issues.civicrm.org/jira/browse/CRM-21286) expose active
  flag in UI for group
  ([11103](https://github.com/civicrm/civicrm-core/pull/11103))**

  A checkbox when editing a group now allows changing whether the group is
  active.

- **[CRM-21497](https://issues.civicrm.org/jira/browse/CRM-21497) crmRouteBinder: add deep comparison option ([11345](https://github.com/civicrm/civicrm-core/pull/11345))**

- **[CRM-21482](https://issues.civicrm.org/jira/browse/CRM-21482) Allow retrieval of currency from $_REQUEST (as supplied by webform_civicrm) ([11348](https://github.com/civicrm/civicrm-core/pull/11348) and [11344](https://github.com/civicrm/civicrm-core/pull/11344))**

- **[CRM-20681](https://issues.civicrm.org/jira/browse/CRM-20681) Automatically search when switching options in Quicksearch ([10466](https://github.com/civicrm/civicrm-core/pull/10466))**

- **[CRM-21204](https://issues.civicrm.org/jira/browse/CRM-21204) Show Import Progress Bar for Activity, Contribution and Membership imports ([11007](https://github.com/civicrm/civicrm-core/pull/11007))**

- **[CRM-20787](https://issues.civicrm.org/jira/browse/CRM-20787) CIVICRM-152 For a repeating Event series. If change the Price Set for a paid Event then this Price Set selection is not applied to all Events in the series even when apply to Every Event is selected ([11161](https://github.com/civicrm/civicrm-core/pull/11161))**

- **[CRM-21476](https://issues.civicrm.org/jira/browse/CRM-21476) Rename 'Clicks' to 'Unique Clicks' in mailing summary report ([11319](https://github.com/civicrm/civicrm-core/pull/11319))**

- **[CRM-21483](https://issues.civicrm.org/jira/browse/CRM-21483) Move anguar module crmRouteBinder to core ([11328](https://github.com/civicrm/civicrm-core/pull/11328))**

- **[CRM-21473](https://issues.civicrm.org/jira/browse/CRM-21473) Adding new permission for adding notes and fixing existing issues with notes permissions ([11314](https://github.com/civicrm/civicrm-core/pull/11314))**

- **[CRM-21409](https://issues.civicrm.org/jira/browse/CRM-21409) Don't bypass hooks when updating thankyou_sent/receipt_sent fields via PDF letter action ([11257](https://github.com/civicrm/civicrm-core/pull/11257))**

- **[CRM-21449](https://issues.civicrm.org/jira/browse/CRM-21449) Add location field to Activity Report ([11296](https://github.com/civicrm/civicrm-core/pull/11296))**

- **[CRM-21448](https://issues.civicrm.org/jira/browse/CRM-21448) Need a link from contribution record when there is no cid in the url ([11295](https://github.com/civicrm/civicrm-core/pull/11295))**

- **[CRM-21419](https://issues.civicrm.org/jira/browse/CRM-21419) Prevent users from accidentally creating a single activity when they want multiple activities ([11264](https://github.com/civicrm/civicrm-core/pull/11264))**

- **[CRM-21406](https://issues.civicrm.org/jira/browse/CRM-21406) Create Standalone Export Form ([11254](https://github.com/civicrm/civicrm-core/pull/11254))**

- **[CRM-21349](https://issues.civicrm.org/jira/browse/CRM-21349) Increase timeout of status message after batch merge. ([11195](https://github.com/civicrm/civicrm-core/pull/11195))**

- **[CRM-21384](https://issues.civicrm.org/jira/browse/CRM-21384) Ensure deleted contacts are filtered out of CiviCase ([11224](https://github.com/civicrm/civicrm-core/pull/11224))**

- **[CRM-21416](https://issues.civicrm.org/jira/browse/CRM-21416) Add reset link beside 'Search' button below Advance Search form ([11260](https://github.com/civicrm/civicrm-core/pull/11260))**

- **[CRM-21408](https://issues.civicrm.org/jira/browse/CRM-21408) Api explorer - better defaults for sequential checkbox ([11256](https://github.com/civicrm/civicrm-core/pull/11256))**

- **[CRM-21382](https://issues.civicrm.org/jira/browse/CRM-21382) Print/Merge document not filed on cases ([11223](https://github.com/civicrm/civicrm-core/pull/11223))**

- **[CRM-21398](https://issues.civicrm.org/jira/browse/CRM-21398) Error when exporting cases ([11245](https://github.com/civicrm/civicrm-core/pull/11245))**

- **[CRM-21106](https://issues.civicrm.org/jira/browse/CRM-21106) Move financial type ACL clause for reports into extension ([10901](https://github.com/civicrm/civicrm-core/pull/10901))**

- **[CRM-21341](https://issues.civicrm.org/jira/browse/CRM-21341) Drupal 8 Hook Support ([11171](https://github.com/civicrm/civicrm-core/pull/11171))**

- **crm- Missing Summary ([11213](https://github.com/civicrm/civicrm-core/pull/11213))**

### NYSS

- **[CRM-21567](https://issues.civicrm.org/jira/browse/CRM-21567) Add email filter for Mail Bounce Report ([11415](https://github.com/civicrm/civicrm-core/pull/11415))**

- **[CRM-21486](https://issues.civicrm.org/jira/browse/CRM-21486) Support multiple test mail ([11332](https://github.com/civicrm/civicrm-core/pull/11332))**

### CiviContribute

- **[CRM-21577](https://issues.civicrm.org/jira/browse/CRM-21577) Add links to payment blocks to allow payments ([11432](https://github.com/civicrm/civicrm-core/pull/11432))**

- **[CRM-21454](https://issues.civicrm.org/jira/browse/CRM-21454) Add money raised on page contribution widget ajax response ([11299](https://github.com/civicrm/civicrm-core/pull/11299))**

### CiviMember

- **[CRM-21504](https://issues.civicrm.org/jira/browse/CRM-21504) Add membership
  to recurring contribution detail
  ([11358](https://github.com/civicrm/civicrm-core/pull/11358))**

  If a recurring contribution auto-renews a membership, a link to the membership
  now appears when viewing the recurring contribution.

### CiviCRM API

- **[CRM-21551](https://issues.civicrm.org/jira/browse/CRM-21551) Add parameter to support skipping processing greetings when calling api contact.create ([11405](https://github.com/civicrm/civicrm-core/pull/11405))**

### CiviReport, NYSS

- **[CRM-21547](https://issues.civicrm.org/jira/browse/CRM-21547) Add UI order by options to Contact logging summary report ([11402](https://github.com/civicrm/civicrm-core/pull/11402))**

### Drupal Integration Modules

- **[CRM-21093](https://issues.civicrm.org/jira/browse/CRM-21093) Move CiviCRM initialization out of service constructor (in Drupal 8) and into method ([11379](https://github.com/civicrm/civicrm-core/pull/11379))**

- **[CRM-21372](https://issues.civicrm.org/jira/browse/CRM-21372) Fatal error adding profile on Drupal 8 ([11216](https://github.com/civicrm/civicrm-core/pull/11216))**

### CiviMail

- **[CRM-21279](https://issues.civicrm.org/jira/browse/CRM-21279) Rebuild recipient list and calculate count on demand, store result in $cacheFactory ([11091](https://github.com/civicrm/civicrm-core/pull/11091))**

- **[CRM-21472](https://issues.civicrm.org/jira/browse/CRM-21472) Make CiviMail token validation extensible ([11316](https://github.com/civicrm/civicrm-core/pull/11316))**

- **[CRM-21383](https://issues.civicrm.org/jira/browse/CRM-21383) Load message templates on demand in CiviMail compose UI ([11267](https://github.com/civicrm/civicrm-core/pull/11267))**

### CiviMail, NYSS

- **[CRM-21468](https://issues.civicrm.org/jira/browse/CRM-21468) mailing recipients field limits how many groups can be selected ([11349](https://github.com/civicrm/civicrm-core/pull/11349))**

### CiviMail, CiviReport

- **[CRM-21501](https://issues.civicrm.org/jira/browse/CRM-21501) bounce report: bounce date filter doesn't include timestamp ([11354](https://github.com/civicrm/civicrm-core/pull/11354))**

### WordPress Integration

- **[CRM-21470](https://issues.civicrm.org/jira/browse/CRM-21470) Add support for WordPress Polylang plugin ([11333](https://github.com/civicrm/civicrm-core/pull/11333) and [11312](https://github.com/civicrm/civicrm-core/pull/11312))**

### CiviCase, CiviMail

- **[CRM-21446](https://issues.civicrm.org/jira/browse/CRM-21446) Allow case id as well as hash in inbound email processing to autofile emails on cases ([11320](https://github.com/civicrm/civicrm-core/pull/11320))**

### CiviCase, Joomla Integration

- **[CRM-21001](https://issues.civicrm.org/jira/browse/CRM-21001) E-notice in com_civicrm/civicrm/CRM/Core/BAO/SchemaHandler.php on line 730 ([11307](https://github.com/civicrm/civicrm-core/pull/11307))**

### CiviReport

- **[CRM-21412](https://issues.civicrm.org/jira/browse/CRM-21412) Do not give fatal error on report when no fields selected ([11259](https://github.com/civicrm/civicrm-core/pull/11259))**

### CiviCase

- **[CRM-21360](https://issues.civicrm.org/jira/browse/CRM-21360) Make 'Open Case' Activity Optional When Defining Case Types ([11204](https://github.com/civicrm/civicrm-core/pull/11204))**

### Extension System, Test suite

- **[CRM-17860](https://issues.civicrm.org/jira/browse/CRM-17860) More consistent, flexible handling of tests for extensions ([11251](https://github.com/civicrm/civicrm-core/pull/11251))**

### Accounting Integration

- **[CRM-21200](https://issues.civicrm.org/jira/browse/CRM-21200) Pay Now payment overwrites the contribution ([11059](https://github.com/civicrm/civicrm-core/pull/11059))**

## <a name="bugs"></a>Bugs resolved

### Core CiviCRM

- **[CRM-21229](https://issues.civicrm.org/jira/browse/CRM-21229) Manage Group
  page is slow if you have smart groups
  ([11050](https://github.com/civicrm/civicrm-core/pull/11050)) (completes
  previous work)**

  Some adjustments were made to improve related tests and to prevent problems
  over repeated test runs.

- **[CRM-21518](https://issues.civicrm.org/jira/browse/CRM-21518) and
  [CRM-21539](https://issues.civicrm.org/jira/browse/CRM-21539) Add missing
  structure divs in templates
  ([11369](https://github.com/civicrm/civicrm-core/pull/11369) and
  [11396](https://github.com/civicrm/civicrm-core/pull/11396))**

  Many administrative forms had minor inconsistencies in their markup,
  complicating the task of retheming.  This adds missing `div` elements and
  classes.

- **[CRM-21180](https://issues.civicrm.org/jira/browse/CRM-21180) Inline changes
  to custom fields aren't reflected in custom greetings
  ([11364](https://github.com/civicrm/civicrm-core/pull/11364))**

  This resolves a bug where greetings that use custom fields would not update to
  reflect changes that are made through inline edits to those fields.

- **[CRM-21298](https://issues.civicrm.org/jira/browse/CRM-21298) Don't offer to
  fix indices until we can do it right
  ([11250](https://github.com/civicrm/civicrm-core/pull/11250))**

  A change in 2017 introduced a warning on the system status page if a site
  lacks a database index that CiviCRM expects.  The warning message would offer
  to "update indices" in the database, resolving the problem.  However, the
  update would fail on some sites due to a database error.

  This change merely suppresses the warning message while work is done to
  improve the update process.

- **[CRM-21433](https://issues.civicrm.org/jira/browse/CRM-21433) Optimize dupe
  checking in Recent Items stack
  ([11281](https://github.com/civicrm/civicrm-core/pull/11281))**

  The Recent Items list now suppresses duplicate items according to their entity
  type and ID.  Previously, duplicates were checked using the URL, which may
  place parameters in a different order each time.

- **[CRM-21595](https://issues.civicrm.org/jira/browse/CRM-21595) Regression: Contribution page no longer works when configured with PayPal Pro and pay later ([11483](https://github.com/civicrm/civicrm-core/pull/11483))**

- **[CRM-21559](https://issues.civicrm.org/jira/browse/CRM-21559) Save button in Case Type not clickable ([11473](https://github.com/civicrm/civicrm-core/pull/11473))**

- **4.7.29 rc ([11448](https://github.com/civicrm/civicrm-core/pull/11448))**

- **4.7.29 rc merge to master ([11441](https://github.com/civicrm/civicrm-core/pull/11441))**

- **4.7.29 rc merge to master ([11437](https://github.com/civicrm/civicrm-core/pull/11437))**

- **Increase minimum php version requirements ([11416](https://github.com/civicrm/civicrm-core/pull/11416))**

- **Merge ([11431](https://github.com/civicrm/civicrm-core/pull/11431))**

- **[CRM-21245](https://issues.civicrm.org/jira/browse/CRM-21245) Incorrect Contribution status "Pending Refund" ([11077](https://github.com/civicrm/civicrm-core/pull/11077))**

- **Remove php 5.3 shim for json formatting ([11421](https://github.com/civicrm/civicrm-core/pull/11421))**

- **[CRM-21560](https://issues.civicrm.org/jira/browse/CRM-21560) CRM_Event_Form_Task fatal error ([11410](https://github.com/civicrm/civicrm-core/pull/11410))**

- **[CRM-21552](https://issues.civicrm.org/jira/browse/CRM-21552) Dedupe Rule : get contact type name instead of label ([11406](https://github.com/civicrm/civicrm-core/pull/11406))**

- **[CRM-21534](https://issues.civicrm.org/jira/browse/CRM-21534) Key UI elements fail when fetching activity records from MariaDB ([11395](https://github.com/civicrm/civicrm-core/pull/11395))**

- **[CRM-21535](https://issues.civicrm.org/jira/browse/CRM-21535) CIVICRM-754: Custom file upload field not showing up when Viewing Activity from Case Report ([11386](https://github.com/civicrm/civicrm-core/pull/11386))**

- **[CRM-21531](https://issues.civicrm.org/jira/browse/CRM-21531) Multi-select custom field searches can crash on MariaDB ([11388](https://github.com/civicrm/civicrm-core/pull/11388))**

- **Update `master` with final `4.7.28` changes ([11387](https://github.com/civicrm/civicrm-core/pull/11387))**

- **[CRM-21492](https://issues.civicrm.org/jira/browse/CRM-21492) Authorize.Net fails on updated recurring contributions ([11338](https://github.com/civicrm/civicrm-core/pull/11338))**

- **Add test for processing multipart-related emails in fetch_bounces ([11378](https://github.com/civicrm/civicrm-core/pull/11378))**

- **4.7.28 rc ([11363](https://github.com/civicrm/civicrm-core/pull/11363))**

- **[CRM-21466](https://issues.civicrm.org/jira/browse/CRM-21466) Fix (obscure) enotice when updating greeting for contact, add test ([11310](https://github.com/civicrm/civicrm-core/pull/11310))**

- **[CRM-20343](https://issues.civicrm.org/jira/browse/CRM-20343) Wrong Activity creation when Membership status is changed from membership form. ([11198](https://github.com/civicrm/civicrm-core/pull/11198))**

- **[CRM-21328](https://issues.civicrm.org/jira/browse/CRM-21328) Remove 'Select' option from price option visibility drop-down (undefined index visibility_id error) ([11193](https://github.com/civicrm/civicrm-core/pull/11193))**

- **Fix ts() functions to have variable on the outside. ([11357](https://github.com/civicrm/civicrm-core/pull/11357))**

- **[CRM-21436](https://issues.civicrm.org/jira/browse/CRM-21436) Fatal error on contribution page with only pay later enabled. ([11334](https://github.com/civicrm/civicrm-core/pull/11334))**

- **[CRM-21457](https://issues.civicrm.org/jira/browse/CRM-21457) CIVICRM-741 Receipt date not updated when submitting a credit card payment from the back-end (Contribution) ([11343](https://github.com/civicrm/civicrm-core/pull/11343))**

- **[CRM-21469](https://issues.civicrm.org/jira/browse/CRM-21469) Cannot remove all groups when editing a contact ([11311](https://github.com/civicrm/civicrm-core/pull/11311))**

- **4.7.28 rc merge to master ([11347](https://github.com/civicrm/civicrm-core/pull/11347))**

- **[CRM-21363](https://issues.civicrm.org/jira/browse/CRM-21363) Ensure that tests run using ONLY_FULL_GROUP_BY sql_mode for mysql 5.7 ([11208](https://github.com/civicrm/civicrm-core/pull/11208))**

- **4.7.28 rc merge to master ([11342](https://github.com/civicrm/civicrm-core/pull/11342))**

- **[CRM-21344](https://issues.civicrm.org/jira/browse/CRM-21344) Links to documentation from installer error messages are broken ([11190](https://github.com/civicrm/civicrm-core/pull/11190))**

- **[CRM-21477](https://issues.civicrm.org/jira/browse/CRM-21477) Buttons missing on Delete Premium product form ([11318](https://github.com/civicrm/civicrm-core/pull/11318))**

- **Merge from rc ([11335](https://github.com/civicrm/civicrm-core/pull/11335))**

- **Currency ([11329](https://github.com/civicrm/civicrm-core/pull/11329))**

- **[CRM-21218](https://issues.civicrm.org/jira/browse/CRM-21218) Improve component statics flushing ([11022](https://github.com/civicrm/civicrm-core/pull/11022))**

- **[CRM-21456](https://issues.civicrm.org/jira/browse/CRM-21456) Relationship end date not set when creating resolved cases. ([11301](https://github.com/civicrm/civicrm-core/pull/11301))**

- **NFC, comments only ([11330](https://github.com/civicrm/civicrm-core/pull/11330))**

- **[CRM-21214](https://issues.civicrm.org/jira/browse/CRM-21214) Chaining shared addresses doesn't work correctly ([11324](https://github.com/civicrm/civicrm-core/pull/11324))**

- **4.7.28 rc ([11326](https://github.com/civicrm/civicrm-core/pull/11326))**

- **[CRM-21190](https://issues.civicrm.org/jira/browse/CRM-21190) Warning error on Thankyou page on pay later membership priceset. ([11303](https://github.com/civicrm/civicrm-core/pull/11303))**

- **NFC rerun setup.sh -dg and regen Participant DAO ([11315](https://github.com/civicrm/civicrm-core/pull/11315))**

- **[CRM-16819](https://issues.civicrm.org/jira/browse/CRM-16819) Improve on CRM_Utils_Request::retrieve() ([11285](https://github.com/civicrm/civicrm-core/pull/11285))**

- **4.7.28 rc ([11308](https://github.com/civicrm/civicrm-core/pull/11308))**

- **[CRM-20861](https://issues.civicrm.org/jira/browse/CRM-20861) Location type does not show for custom address fields ([10650](https://github.com/civicrm/civicrm-core/pull/10650))**

- **(NFC) .toxic.json - Update list of functions which yield toxic warnings ([11302](https://github.com/civicrm/civicrm-core/pull/11302))**

- **[NFC] code cleanup: split out 2 functions that are mostly unrelated. ([11284](https://github.com/civicrm/civicrm-core/pull/11284))**

- **4.7.28 rc ([11297](https://github.com/civicrm/civicrm-core/pull/11297))**

- **[CRM-21324](https://issues.civicrm.org/jira/browse/CRM-21324) Support 'null' on date fields in the api ([11152](https://github.com/civicrm/civicrm-core/pull/11152))**

- **[NFC] Function extraction and renaming of variable for shorter refere… ([11278](https://github.com/civicrm/civicrm-core/pull/11278))**

- **[NFC] Fix a bunch of docstrings ([11034](https://github.com/civicrm/civicrm-core/pull/11034))**

- **[CRM-21312](https://issues.civicrm.org/jira/browse/CRM-21312) Fix display of Recent Items when using a bootstrap theme ([11138](https://github.com/civicrm/civicrm-core/pull/11138))**

- **[CRM-14343](https://issues.civicrm.org/jira/browse/CRM-14343) Import Error File Maxes out at 250 ([11233](https://github.com/civicrm/civicrm-core/pull/11233))**

- **[NFC] Additional test ([11266](https://github.com/civicrm/civicrm-core/pull/11266))**

- **[CRM-21426](https://issues.civicrm.org/jira/browse/CRM-21426) Cancel/Delete Event Participants - Duplicate Submit Buttons ([11277](https://github.com/civicrm/civicrm-core/pull/11277))**

- **[CRM-21422](https://issues.civicrm.org/jira/browse/CRM-21422) TimeZone handling for Europe/London fails ([11273](https://github.com/civicrm/civicrm-core/pull/11273))**

- **4.7.28 rc ([11275](https://github.com/civicrm/civicrm-core/pull/11275))**

- **[NFC] Minor refactor of test to allow re-use ([11265](https://github.com/civicrm/civicrm-core/pull/11265))**

- **[CRM-21400](https://issues.civicrm.org/jira/browse/CRM-21400) Add in static var on contribution thank you page to hold trxn id ([11247](https://github.com/civicrm/civicrm-core/pull/11247))**

- **[CRM-21395](https://issues.civicrm.org/jira/browse/CRM-21395) DOMPDF produces either white screen or No-Block-Level parent found error in some circumstances blocking invoice production ([11246](https://github.com/civicrm/civicrm-core/pull/11246) and [11243](https://github.com/civicrm/civicrm-core/pull/11243))**

- **4.7.28 rc ([11237](https://github.com/civicrm/civicrm-core/pull/11237))**

- **[CRM-21393](https://issues.civicrm.org/jira/browse/CRM-21393) Event Location page is slow (because of checkPermission) ([11242](https://github.com/civicrm/civicrm-core/pull/11242))**

- **[CRM-21385](https://issues.civicrm.org/jira/browse/CRM-21385) WordPress top nav bar blocks top row of WYSIWYG editor when maximized ([11230](https://github.com/civicrm/civicrm-core/pull/11230))**

- **[CRM-20728](https://issues.civicrm.org/jira/browse/CRM-20728) Store session in drupal session table before exiting ([10501](https://github.com/civicrm/civicrm-core/pull/10501))**

- **[CRM-20899](https://issues.civicrm.org/jira/browse/CRM-20899) Format refund amount ([10687](https://github.com/civicrm/civicrm-core/pull/10687))**

- **Fix GenerateData for only_full_group_by sqlMode ([11225](https://github.com/civicrm/civicrm-core/pull/11225))**

- **Lint civicrm.module and civicrm.install files ([467](https://github.com/civicrm/civicrm-drupal/pull/467))**

- **[CRM-20153](https://issues.civicrm.org/jira/browse/CRM-20153) Drupal Views: PCP Pages for Events not showing up in list of pages ([463](https://github.com/civicrm/civicrm-drupal/pull/463))**

- **[CRM-20734](https://issues.civicrm.org/jira/browse/CRM-20734) State doesn't populate on first load of view even if country is selected. ([506](https://github.com/civicrm/civicrm-drupal/pull/506))**

- **[CRM-21458](https://issues.civicrm.org/jira/browse/CRM-21458) (CIVICRM-742) HTML_QuickForm_hierselect doesn't handle JS escaping properly ([196](https://github.com/civicrm/civicrm-packages/pull/196))**

### CiviContribute

- **[CRM-21465](https://issues.civicrm.org/jira/browse/CRM-21465) clicking on
- pledge link in email returns fatal error
- ([11305](https://github.com/civicrm/civicrm-core/pull/11305))**

- **[CRM-20676](https://issues.civicrm.org/jira/browse/CRM-20676) Tax applied repeatedly on edits of price set events ([11455](https://github.com/civicrm/civicrm-core/pull/11455))**

- **[CRM-20800](https://issues.civicrm.org/jira/browse/CRM-20800) User Cannot Cancel Recurring Payment With Paypal  ([11359](https://github.com/civicrm/civicrm-core/pull/11359) and [10986](https://github.com/civicrm/civicrm-core/pull/10986))**

- **[CRM-21342](https://issues.civicrm.org/jira/browse/CRM-21342) Contribution note is not wiped if the value is removed ([11187](https://github.com/civicrm/civicrm-core/pull/11187))**

- **[CRM-21478](https://issues.civicrm.org/jira/browse/CRM-21478) Pay Now on user dashboard only works in english ([11323](https://github.com/civicrm/civicrm-core/pull/11323))**

- **[CRM-20569](https://issues.civicrm.org/jira/browse/CRM-20569) Record Payment for partially paid membership: update amt, fix deferred  ([11000](https://github.com/civicrm/civicrm-core/pull/11000))**

- **[CRM-21424](https://issues.civicrm.org/jira/browse/CRM-21424) Print Contribution Receipt does not set receipt_date when downloading pdf receipts ([11289](https://github.com/civicrm/civicrm-core/pull/11289))**

- **[CRM-21432](https://issues.civicrm.org/jira/browse/CRM-21432) Fix display of end date for recurring contributions ([11283](https://github.com/civicrm/civicrm-core/pull/11283))**

- **[CRM-20166](https://issues.civicrm.org/jira/browse/CRM-20166) Setting CVV is 'not required for backend' affects all front facing forms ([11205](https://github.com/civicrm/civicrm-core/pull/11205))**

- **[CRM-20164](https://issues.civicrm.org/jira/browse/CRM-20164) PayPal Standard notify_url breaks with Joomla when derived from menu item ([11236](https://github.com/civicrm/civicrm-core/pull/11236))**

### CiviMail

- **[CRM-21197](https://issues.civicrm.org/jira/browse/CRM-21197) Convert from html to plain text AFTER token substitution has happened ([11442](https://github.com/civicrm/civicrm-core/pull/11442) and [10998](https://github.com/civicrm/civicrm-core/pull/10998))**

- **[CRM-19704](https://issues.civicrm.org/jira/browse/CRM-19704) Image-only emails fail to send ([11399](https://github.com/civicrm/civicrm-core/pull/11399))**

- **[CRM-21206](https://issues.civicrm.org/jira/browse/CRM-21206) Recipients missing from AB Test Report ([11010](https://github.com/civicrm/civicrm-core/pull/11010))**

- **[CRM-21378](https://issues.civicrm.org/jira/browse/CRM-21378) Incorporate email abuse report as a spam type of bounce ([11226](https://github.com/civicrm/civicrm-core/pull/11226))**

### CiviReport

- **[CRM-21538](https://issues.civicrm.org/jira/browse/CRM-21538) CiviReport: Field not found when sorting by Case Type as a section header ([11419](https://github.com/civicrm/civicrm-core/pull/11419))**

- **[CRM-16241](https://issues.civicrm.org/jira/browse/CRM-16241) Activity details truncated in activity report ([11397](https://github.com/civicrm/civicrm-core/pull/11397))**

- **[CRM-19060](https://issues.civicrm.org/jira/browse/CRM-19060) Membership Detailed Report Payment Amount (most recent) not reporting correct contribution ([11389](https://github.com/civicrm/civicrm-core/pull/11389))**

- **[CRM-20545](https://issues.civicrm.org/jira/browse/CRM-20545) contact report lists contacts that have been 'soft' deleted (placed in Trash) ([11276](https://github.com/civicrm/civicrm-core/pull/11276))**

- **[CRM-21447](https://issues.civicrm.org/jira/browse/CRM-21447) Contact Relationship Report fatal error if used from the API with a relationship_type_id filter (also affects excel export) ([11293](https://github.com/civicrm/civicrm-core/pull/11293))**

### NYSS

- **[CRM-21563](https://issues.civicrm.org/jira/browse/CRM-21563) Cannot search child tags on 'Manage Tag' page ([11414](https://github.com/civicrm/civicrm-core/pull/11414))**

- **[CRM-21362](https://issues.civicrm.org/jira/browse/CRM-21362) Mailing summary report group by MySQL 5.7 error ([11261](https://github.com/civicrm/civicrm-core/pull/11261))**

### CiviCase

- **[CRM-21507](https://issues.civicrm.org/jira/browse/CRM-21507) Unable to add multiple target contacts to a new case activity ([11360](https://github.com/civicrm/civicrm-core/pull/11360))**

- **[CRM-21421](https://issues.civicrm.org/jira/browse/CRM-21421) Cannot update existing CaseContact ([11268](https://github.com/civicrm/civicrm-core/pull/11268) and [11270](https://github.com/civicrm/civicrm-core/pull/11270))**

### CiviEvent

- **[CRM-21513](https://issues.civicrm.org/jira/browse/CRM-21513) Change fee
  selection for text price field on backoffice Event registration Not Creating
  Correct Financial Items
  ([11380](https://github.com/civicrm/civicrm-core/pull/11380))**

### CiviMember

- **[CRM-19608](https://issues.civicrm.org/jira/browse/CRM-19608) "Auto Renew Required" is not enforced during membership registration using priceset. ([9648](https://github.com/civicrm/civicrm-core/pull/9648))**

- **[CRM-21265](https://issues.civicrm.org/jira/browse/CRM-21265) For failed membership transaction, update payment status to failed ([11072](https://github.com/civicrm/civicrm-core/pull/11072))**

- **[CRM-21357](https://issues.civicrm.org/jira/browse/CRM-21357) Batch Data Entry: Start date is NULL when membership batch entry is processed ([11202](https://github.com/civicrm/civicrm-core/pull/11202))**

### Accounting Integration, CiviContribute

- **[CRM-19273](https://issues.civicrm.org/jira/browse/CRM-19273) Changes to Event Option Value Selections on Pending (Pay Later) Contribution Not Creating Correct Financial Items Causing Imbalance in Accounting Batch Export ([10962](https://github.com/civicrm/civicrm-core/pull/10962), [11300](https://github.com/civicrm/civicrm-core/pull/11300), and [11272](https://github.com/civicrm/civicrm-core/pull/11272))**

### Core CiviCRM, Import

- **[CRM-19888](https://issues.civicrm.org/jira/browse/CRM-19888) On contact import, State field does not respect default country ([10740](https://github.com/civicrm/civicrm-core/pull/10740))**

### Usability

- **[CRM-21389](https://issues.civicrm.org/jira/browse/CRM-21389) Add Regions to Contact UserDashBoard ([11235](https://github.com/civicrm/civicrm-core/pull/11235))**

### Backdrop Integration, Drupal Integration Modules

- **[CRM-20764](https://issues.civicrm.org/jira/browse/CRM-20764) Need to update civicrm.settings.php to account for clean urls in Backdrop ([10674](https://github.com/civicrm/civicrm-core/pull/10674))**

### Internationalisation

- **[CRM-19915](https://issues.civicrm.org/jira/browse/CRM-19915) Multi-lingual Upgrade from 4.6 fails on missing DB table or field ([9739](https://github.com/civicrm/civicrm-core/pull/9739))**

- **[CRM-21407](https://issues.civicrm.org/jira/browse/CRM-21407) ISO compliance for German counties ([11255](https://github.com/civicrm/civicrm-core/pull/11255))**

### CiviCRM API

- **[CRM-21041](https://issues.civicrm.org/jira/browse/CRM-21041) API Bug when Creating Contact with Webform-Civicrm ([11269](https://github.com/civicrm/civicrm-core/pull/11269))**

### WordPress Integration

- **[CRM-20358](https://issues.civicrm.org/jira/browse/CRM-20358) WordPress access control table is basically unusable ([11253](https://github.com/civicrm/civicrm-core/pull/11253))**

### Drupal Integration

- **[CRM-21526](https://issues.civicrm.org/jira/browse/CRM-21526)
  CRM_Utils_System_Drupal8::authenticate() is incomplete
  ([11381](https://github.com/civicrm/civicrm-core/pull/11381)) (partial work)**

  The method for scripts to authenticate a Drupal 8 user would simply return the
  user ID rather than switching to that user.

- **[CRM-20783](https://issues.civicrm.org/jira/browse/CRM-20783) undefined currency error when pricefield value is included in view ([458](https://github.com/civicrm/civicrm-drupal/pull/458))**

- **[CRM-20592](https://issues.civicrm.org/jira/browse/CRM-20592) Drupal Views integration : bug when selecting website  ([446](https://github.com/civicrm/civicrm-drupal/pull/446))**

- **[CRM-20292](https://issues.civicrm.org/jira/browse/CRM-20292) Drush cc all clears custom fields from Drupal Views ([472](https://github.com/civicrm/civicrm-drupal/pull/472))**

## <a name="misc"></a>Miscellany

- **[CRM-21555](https://issues.civicrm.org/jira/browse/CRM-21555) Replace
  `CRM_Core_OptionGroup::getValue` with `CRM_Core_PseudoConstant::getKey` for
  Case ([11409](https://github.com/civicrm/civicrm-core/pull/11409))**

- **[CRM-21548](https://issues.civicrm.org/jira/browse/CRM-21548) Remove unused
  variables from `CRM_Utils_Address::format`
  ([11403](https://github.com/civicrm/civicrm-core/pull/11403))**

- **[CRM-21544](https://issues.civicrm.org/jira/browse/CRM-21544) Remove unused
  `CRM_Contact_BAO_Contact_Optimizer` class
  ([11400](https://github.com/civicrm/civicrm-core/pull/11400))**

- **[CRM-21527](https://issues.civicrm.org/jira/browse/CRM-21527) Add default to
  extra address::create param
  ([11382](https://github.com/civicrm/civicrm-core/pull/11382))**

- **[CRM-21517](https://issues.civicrm.org/jira/browse/CRM-21517)
  UpdateSubscription OptionGroup->PseudoConstant
  ([11367](https://github.com/civicrm/civicrm-core/pull/11367))**

- **[CRM-21471](https://issues.civicrm.org/jira/browse/CRM-21471) Remove unused
  function CRM_Core_Pseudoconstant::greetingDefaults
  ([11313](https://github.com/civicrm/civicrm-core/pull/11313))**

## <a name="credits"></a>Credits

This release was developed by the following code authors:

AGH Strategies - Andrew Hunt; Agileware - Agileware Team, Alok Patel; agileware-fj; Australian Greens - Seamus Lee; British Humanist Association - Andrew West; Christian Wach; CiviCRM - Coleman Watts, Tim Otten; CiviDesk - Sunil Pawar, Yashodha Chaku; CiviFirst - John Kirk; clnlf; Community IT Academy - William Mortada; CompuCorp - Camilo Rodriguez, Mukesh Ram, Omar Abu Hussein; Coop SymbioTIC - Mathieu Lutfy, Samuel Vanhove; Deepak Srivastava; Ergon Logic Enterprises - Christopher Gervais; Francesc Bassas i Bullich; Freeform Solutions - Herb van den Dool; Fuzion - Jitendra Purohit; javiya-rupal; Jazz-Man; JMA Consulting - Edsel Lopez, Monish Deb, Pradeep Nayak; John Kingsnorth; Joinery - Allen Shaw; kerasai; Kompetenzzentrum Technik-Diversity-Chancengleichheit - Niels Heinemann; Left Join Labs - Sean Madsen; Lighthouse Design and Consulting - Brian Shaughnessy; Megaphone Technology Consulting - Jon Goldberg; mihaelmladenov; MJW Consulting - Matthew Wire; myDropWizard - David Snopek; nbrettell; Oxfam Germany - Thomas Schüttler; Progressive Technology Project - Jamie McClelland; Squiffle Consulting - Aidan Saunders; Stephen Palmstrom; Third Sector Design - Michael McAndrew; Timbsoft Technologies - Tunbola Ogunwande; username12; varshith; Wikimedia Foundation - Eileen McNaughton, Elliott Eggleston, Maggie Epps

Most authors also reviewed code for this release; in addition, the following
reviewers contributed their comments:

a-irvine; AGH Strategies - Andrew Hunt; Agileware - Agileware Team; agileware-fj; AnneDru; Australian Greens - Seamus Lee; Avietech - Jonathan Boeke; bgmtest; British Humanist Association - Andrew West; CEDC - Laryn Kragt Bakker; Chris Burgess; Christian Wach; christophe.golle@gmail.com; Circle Interactive - Dave Jenkins; CiviCoop - Klaas Eikelboom; civicrm-builder; CiviCRM - Coleman Watts, Tim Otten; CiviDesk - Sunil Pawar, Yashodha Chaku; CiviFirst - John Kirk; clnlf; Community IT Academy - William Mortada; CompuCorp - Camilo Rodriguez, Guanhuan Chen, Madura Krishnamoorthy, Mukesh Ram, Omar Abu Hussein; Coop SymbioTIC - Mathieu Lutfy, Samuel Vanhove; dandoran-wp; Daniël van Vuuren; Dave D; dsuguy2007; Elennio; Ergon Logic Enterprises - Christopher Gervais; EvanC; fatih24500; Forest CRM Consulting - Tamar Meir; Francesc Bassas i Bullich; Freeform Solutions - Herb van den Dool; Fuzion - Jitendra Purohit, Peter Davis; Ginkgo Street Labs - Dan O'Brien; grahamsmith; Hartmann Computer Consulting - Peter Hartmann; hfarooq; igorpavlov; Jazz-Man; jehanley; JMA Consulting - Edsel Lopez, Joe Murray, Monish Deb, Pradeep Nayak; Joanne Chester; John Kingsnorth; johntwyman; Joinery - Allen Shaw; Joseph Lacey; julian.libor; kerasai; kirk; Kompetenzzentrum Technik-Diversity-Chancengleichheit - Niels Heinemann; Korlon - Stuart Gaston; Left Join Labs - Sean Madsen; Lemniscus - Noah Miller; Lighthouse Design and Consulting - Brian Shaughnessy; Lullabot - Nate Lampton; madurak; MC3 - Graham Mitchell; Megaphone Technology Consulting - Jon Goldberg; mihaelmladenov; MJW Consulting - Matthew Wire; myDropWizard - David Snopek; National Democratic Institute - Dean Valentine; nbrettell; Neil Zampella; octo-happiness; Oxfam Germany - Thomas Schüttler; PhilMorBru; pratiksha; Progressive Technology Project - Jamie McClelland; Robert Lang; rupaljaviya; Semper IT - Karin Gerritsen; Skvare - Mark Hanna; slbradio; Spry Digital - Ellen Hendricks; Squiffle Consulting - Aidan Saunders; Stan Dragnev; Stephen Palmstrom; Systopia - Björn Endres; Tadpole Collective - Kevin Cristiano; Third Sector Design - Michael McAndrew; thisguy; Torrance Hodgson; tottens; tunbola@compucorp.co.uk; varshith; websiteexpress; Wikimedia Foundation - Eileen McNaughton, Maggie Epps; yaazkal

## <a name="feedback"></a>Feedback

These release notes are edited by Andrew Hunt.  If you'd like to provide
feedback on them, please login to https://chat.civicrm.org/civicrm and contact
`@agh1`.
